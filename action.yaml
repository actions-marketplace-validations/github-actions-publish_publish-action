name: 'Publish Github Action'
description: 'Publishes Github action and tags release'
inputs:
  branch:
    description: Branch to commit action to. Default will use the current.
    required: false
  tag:
    description: name of the git tag to use to tag the action.
    required: true
    default: v1

runs:
  using: "composite"
  steps:
    - run: |
        git config --global user.email "${{github.event.pusher.email}}"
        git config --global user.name "${{github.event.pusher.name}}"
      shell: bash
    - run: |
        if [ ! -z "${{ inputs.branch }}" ]
        then
          TEMP_DIR=`mktemp -d`
          cp -r -a . $TEMP_DIR/
          git switch -c ${{ inputs.branch }}
          rm -rf ./*
          cp -r -a $TEMP_DIR/* .
          git add .
          if [ -f node_modules ]
          then
            git add -f node_modules
          fi
          git commit -m "Release for ${{ inputs.tag }}"
          git push --set-upstream origin ${{ inputs.branch }}
        fi
          
        git tag -f -a ${{ inputs.tag }} -m "Release for ${{ inputs.tag }}"
        git push -f --tags
      shell: bash